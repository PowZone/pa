<?php 
    header('Content-type: application/json');
    $keywords = '{super_search_keywords}'; 
    $tags = explode( ', ', $keywords);
?>
[
    {
        "keywords" : {exp:json_encode}{super_search_keywords}{/exp:json_encode}
    },
{exp:super_search:results
    paginate="both"
    limit="10"
    orderby="entry_date+desc+title+asc"
    where="any"
    backspace="2"
}
    {if super_search_no_results}
        "no results"
    {/if}
    {if gallery_photography}
    {
        "code" : "images",
        "images" : [
            <?php
                foreach( $tags as $tag ) {
            ?>
            {gallery_photography backspace="0"}
                <?php 
                    $pos = strpos( '{image:field:1}', $tag );
                    if ( $pos !== false ) {
                ?>
            { 
                "id" : "{image:id}",
                "lg_thumb" : "{image:url:lg-thumb}",
                "thumb" : "{image:url:thumb}",
                "url" : "{image:url:full-size}",
                "caption": "{image:description}",
                "keywords" : "{image:field:1}"
            },
                <?php } ?>
            {/gallery_photography}
            <?php } ?>
        ]
    },
    {/if}
    {
		{if year_film}
			"code": "film",
	        "id" : "{entry_id}",
	        "title": "{title}",
	        "date" : "{year_film}000",
	        "url": "{url_title}",
	        "thumb" : "{cover_image_film}{image:url:thumb}{/cover_image_film}",
	        "summary": {exp:json_encode}{summary_film}{/exp:json_encode},
	        {if video_id_film}
	        "video_id": "{video_id_film}",
	        {if:else}
	        "video_src" : "{video_src_film}",
	        {/if}
	        "youtube" : "{youtube_film}",
	        "content": {exp:json_encode}{content_film}{/exp:json_encode},
	        "caption" : {exp:json_encode}{caption_film}{/exp:json_encode}
	    {/if} 
	    
	    {if date_awards}
	    	"code": "awards",
	        "id" : "{entry_id}",
	        "type" : "awards",
	        "title" : "{title}",
	        "date" : "{date_awards}000",
	        "summary" : "{summary_awards}"
	    {/if}  
	    
	    {if image_bio}
	    	"code": "bio",
	        "id" : "{entry_id}",
	        "type" : "bio",
	        "title": "Bio/CV",
	        "url" : "bio",
	        "bioImg" : "{image_bio}{image:url:layout}{/image_bio}",
	        "content": {exp:json_encode}{content_profile}{/exp:json_encode}
	    {/if}
	    
	    
	    {if date_article}
	    	"code": "articles",
	        "id" : "{entry_id}",
	        "title" : "{title}",
	        "date" : "{date_article}000",
	        "url" : "{url_title}",
	        "summary": {exp:json_encode}{summary_article}{/exp:json_encode},
	        "content": {exp:json_encode}{content_article}{/exp:json_encode},
	        "gallery": [
	        {gallery_article backspace="11"}
	            {
	                "thumb" : "{image:url:thumb}",
	                "url" : "{image:url:full}",
	                "caption" : {exp:json_encode}{image:description}{/exp:json_encode},
                    "keywords" : "{image:field:1}"
	            },
	        {/gallery_article}
	        ]
        {/if}	  
        
        
        {if paPhotos_profile}
        	"code": "paphotos",
	        "id" : "{entry_id}",
	        "type" : "photos-of-pa",
	        "url" : "photos-of-pa",
	        "gallery": [
	            {paPhotos_profile backspace="14"}
	            { 
	                "thumb" : "{image:url:thumb}",
	                "lg_thumb" : "{image:url:lg-thumb}",
	                "url" : "{image:url:full}",
	                "caption" : "{image:description}",
                    "keywords" : "{image:field:1}"
	            },
	            {/paPhotos_profile}
	        ]  
        {/if}   
        
        
        {if gallery_photography}
	        "code": "album",
	        "id" : "{entry_id}",
	        "title": "{title}",
	        "date" : "{year_photography}000",
	        "url": "{url_title}",
	        "summary": {exp:json_encode}{summary_photography}{/exp:json_encode},
	        "cover" : {
	        {gallery_photography cover_only="yes"}
	            {if image:category == 'landscape'}
	            "thumb" : "{image:url:landscape}",
	            "wide" : "true",
	            "caption" : "{if image:description}{image:description}{/if}",
	            {if:else}
	            "thumb" : "{image:url:portrait}",
	            "wide" : "",
	            "caption" : "{if image:description}{image:description}{/if}",
	            {/if}
	            "url" : "{url_title}"
	        {/gallery_photography}
	        },  
	        "gallery": [
	            {gallery_photography backspace="15"}
	            {
	                "thumb" : "{image:url:thumb}",
	                "lg_thumb" : "{image:url:lg-thumb}",
	                "caption" : {exp:json_encode}{image:description}{/exp:json_encode},
	                "url" : "{image:url}",
                    "keywords" : "{image:field:1}"
	        	},
	            {/gallery_photography}
	        ]
        {/if}	

        {if year_projects}
        	"code": "projects",
	        "id" : "{entry_id}",
	        "title": "{title}",
	        "date" : "{year_projects}000",
	        "url": "{url_title}",
	        {!--"logo" : "{logo_projects}{image:url:logo-thumb}{/logo_projects}",--}
	        "cover" : {
	        {cover_projects}
	        {if image:category == 'landscape'}
	            "thumb" : "{image:url:landscape}",
	            "wide" : "true",
	        {if:else}
	            "thumb" : "{image:url:portrait}",
	            "wide" : "",
	        {/if}
	            "caption" : "{image:description}",
	        {/cover_projects}
	            "url" : "{url_title}"
	        },
	        "summary": {exp:json_encode}{summary_projects}{/exp:json_encode},
	        "brand_tags" : 
	        [
	            {categories show_group="21" backspace="15"}
	            { 
	                "title" : "{category_name}",
	                "className" : "{category_url_title}",
	                "logo" : "{category_image}"
	            },
	            {/categories}
	        ],
	        "industry_tags" : 
	        [
	            {categories show_group="1" backspace="15"}
	            { 
	                "title" : "{category_name}",
	                "className" : "{category_url_title}"
	            },
	            {/categories}
	        ],
	        "type_tags" : 
	        [
	            {categories show_group="11" backspace="15"}
	            { 
	                "title" : "{category_name}",
	                "className" : "{category_url_title}"
	            },
	            {/categories}
	        ],
	        "showcases": 
	        [ 
	            {exp:playa:children field="products_project" backspace="15"}
	            { 
	                "title" : "{title}",
	                "url_title": "{url_title}",
	                {if gallery_project}
	                "type" : "gallery",
	                "images": [
	                    {gallery_project backspace="23"}
	                    { 
	                        "lg_thumb" : "{image:url:lg-thumb}",
	                        "thumb" : "{image:url:thumb}",
	                        "url" : "{image:url:full-size}",
	                        "caption": "{image:description}",
                            "keywords" : "{image:field:1}"
	                    },
	                    {/gallery_project}
	                ]
	                {if:elseif video_id_project}
	                "type" : "video",
	                "video_id": "{video_id_project}",
	                "caption" : "{video_caption_project}",
	                "youtube" : "{youtube}"
	                {if:elseif video_src_project}
	                "type" : "video",
	                "video_src": "{video_src_project}",
	                "caption" : "{video_caption_project}",
	                "youtube" : "{youtube}"
	                {/if}
	            },
	            {/exp:playa:children}
	        ],
	        "info" : {exp:json_encode}{info_projects}{/exp:json_encode},
	        "relatedLinks" : [
                {related_links backspace="13"}
	                "{item}",
	            {/related_links}
	        ] 
        {/if}      
        
        {if gallery_project}
            "code" : "image showcase",
            "title" : "{title}",
            "url_title": "{url_title}",
            "gallery" : {
                "images": [
                    {gallery_project backspace="22"}
                    { 
                        "lg_thumb" : "{image:url:lg-thumb}",
                        "thumb" : "{image:url:thumb}",
                        "url" : "{image:url:full-size}",
                        "caption": "{image:description}",
                        "keywords" : "{image:field:1}"
                    },
                    {/gallery_project}
                ]
            }
        {/if}

        {if lines}
            "code" : "quotes",
            "title" : "{title}",
            "lines" : [
            {lines backspace="12"}
                "{item}",
            {/lines}
            ]
        {/if}
    },
{/exp:super_search:results}
]
