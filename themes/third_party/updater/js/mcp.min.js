(function(e,t){"use strict";function n(e,t){var n,a,o={backup_files:j.find(".backup_files input:checked").val(),backup_db:j.find(".backup_db input:checked").val()},i=["backup_files","backup_db"];e===!0&&(j.find(".backup_db .js-yes").attr("checked","checked"),o.backup_db="yes"),t===!0&&(j.find(".backup_files .js-yes").attr("checked","checked"),o.backup_files="yes");for(var s=0;i.length>s;s++)a=!1,w.find(".type-"+i[s]).length>0&&(a=!0),a===!1&&"yes"==o[i[s]]?(n={},n.type=i[s],n.updaterAction="Backup","backup_db"==i[s]&&e===!0&&(n.status="forced"),"backup_files"==i[s]&&t===!0&&(n.status="forced"),r(n)):a===!0&&"no"==o[i[s]]&&w.find(".type-"+i[s]).remove()}function r(e){var t,r="after";e.id=Updater.generateRandomString(),e.status===void 0&&(e.status="queued"),"ee"==e.type&&n(!0,!0),("backup_files"==e.type||"backup_db"==e.type)&&(r="before"),t=Updater.Templates.action_row(e),w.find(".js-no_actions").hide(),"after"==r?w.find(".type-ee").length>0?w.find(".type-ee").before(t):w.append(t):w.prepend(t),w.find("tr.action:not(.type-backup_db,.type-backup_files)").length>0&&j.find("button.start_action").removeAttr("disabled").removeClass("disabled"),R[e.id]=e,o()}function a(){var e=Updater.Templates.action_row(A);t("#"+A.id).replaceWith(e),w.sortable("update")}function o(){w.sortable({items:"> .action:not(.type-ee)",handle:".move"})}function i(){var e,t,n=w.find("tr.status-forced, tr.status-queued");if(0===n.length)return!1;if(e=n.first(),t=e.attr("id"),R[t]===void 0)return!1;if("queued"!=R[t].status&&"forced"!=R[t].status)return!1;switch(R[t].type){case"backup_files":s(t);break;case"backup_db":u(t);break;case"addon":case"ee_forum":case"ee_msm":case"cp_theme":case"forum_theme":l(t);break;case"ee":f(t)}}function s(e){A=R[e],A.status="processing",A.loadingMsg="Preparing Files Backup",a(),t.ajax({url:Updater.MCP_AJAX_URL+"&task=backup_files_prepare"+"&cache="+Updater.generateRandomString(),dataType:"json",type:"POST",data:{XID:EE.XID,time:P},error:function(e){T(e)},success:function(e){X=e.dirs,d(0)}})}function d(e){var n;return 0===e&&(A.progressMsg="&nbsp;",delete A.loadingMsg,a()),X[e]===void 0?(A.status="done",delete A.progressMsg,a(),i(),void 0):(n=100/X.length*e,t("#single_action_progress").css("width",n+"%"),t("#single_action_progress").find(".inner").html(X[e]),t.ajax({url:Updater.MCP_AJAX_URL+"&task=backup_files"+"&cache="+Updater.generateRandomString(),dataType:"json",type:"POST",data:{action:"backup",dir:X[e],time:P,XID:EE.XID},error:function(e){T(e)},success:function(t){return"no"==t.success?(T(t.body),void 0):(d(e+1),void 0)}}),void 0)}function u(e){A=R[e],A.status="processing",A.loadingMsg="Preparing Files Backup",a(),t.ajax({url:Updater.MCP_AJAX_URL+"&task=backup_database_prepare"+"&cache="+Updater.generateRandomString(),dataType:"json",type:"POST",data:{XID:EE.XID},error:function(e){T(e)},success:function(e){x=e.tables,c(0)}})}function c(e){var n;return 0===e&&(A.progressMsg="&nbsp;",delete A.loadingMsg,a()),x[e]===void 0?(A.status="done",delete A.progressMsg,a(),i(),void 0):(n=100/x.length*e,t("#single_action_progress").css("width",n+"%"),t("#single_action_progress").find(".inner").html(x[e]),t.ajax({url:Updater.MCP_AJAX_URL+"&task=backup_database"+"&cache="+Updater.generateRandomString(),dataType:"json",type:"POST",data:{action:"backup",table:x[e],time:P,XID:EE.XID},error:function(e){T(e)},success:function(t){return"no"==t.success?(T(t.body),void 0):(c(e+1),void 0)}}),void 0)}function l(e){A=R[e],A.status="processing",A.loadingMsg="Moving Files",a(),t.ajax({url:Updater.MCP_AJAX_URL+"&task=addon_move_files"+"&cache="+Updater.generateRandomString(),dataType:"json",type:"POST",data:{addon:JSON.stringify(A),XID:EE.XID},error:function(e){T(e)},success:function(t){if("no"==t.success)return T(t.body),void 0;if(t.queries)for(var n=0;t.queries.length>n;n++)Updater.queries.push(t.queries[n]+";");return"addon"==A.type||"ee_forum"==A.type?(p(e),void 0):(A.status="done",delete A.loadingMsg,a(),i(),M(),void 0)}})}function p(){A.loadingMsg="install"==A.updaterAction?"Installing...":"Updating...",a(),t.ajax({url:Updater.MCP_AJAX_URL+"&task=addon_install"+"&cache="+Updater.generateRandomString(),dataType:"json",type:"POST",data:{addon:JSON.stringify(A),XID:EE.XID},error:function(e){T(e)},success:function(e){if("no"==e.success)return T(e.body),void 0;if(e.queries)for(var t=0;e.queries.length>t;t++)Updater.queries.push(e.queries[t]+";");A.status="done",delete A.loadingMsg,a(),i(),M()}})}function f(e){A=R[e],A.status="processing",A.loadingMsg="Putting site offline...",a(),t.ajax({url:Updater.MCP_AJAX_URL+"&task=ee_update_init"+"&cache="+Updater.generateRandomString(),dataType:"json",type:"POST",data:{action:"site_offline",action_obj:JSON.stringify(A),XID:EE.XID},error:function(e){T(e)},success:function(e){return"no"==e.success?(T(e.body),void 0):(g(),void 0)}})}function g(){A.loadingMsg="Copying installer files...",a(),t.ajax({url:Updater.MCP_AJAX_URL+"&task=ee_update_init"+"&cache="+Updater.generateRandomString(),dataType:"json",type:"POST",data:{action:"copy_installer",action_obj:JSON.stringify(A),XID:EE.XID},error:function(e){T(e)},success:function(e){return"no"==e.success?(T(e.body),void 0):(q=e.updates,D=e.server,0===q.length?(_(),void 0):(_(),void 0))}})}function _(e){e?e++:e=1,A.loadingMsg="Waiting for server to respond. Attempts: "+e,a(),t.ajax({url:E+"index/"+Updater.generateRandomString(),dataType:"json",type:"POST",data:{action_obj:JSON.stringify(A),server:D},timeout:3e3,error:function(){setTimeout(function(){_(e)},1e3)},success:function(t){t&&t.success?v():setTimeout(function(){_(e)},1e3)}})}function v(){A.loadingMsg="Preparing Files Copy",a(),t.ajax({url:E+"copy_files_prepare"+"/"+Updater.generateRandomString(),dataType:"json",type:"POST",data:{action_obj:JSON.stringify(A),server:D},error:function(e){T(e)},success:function(e){return"no"==e.success?(T(e.body),void 0):(U=e.dirs,m(0),void 0)}})}function m(e){var n;return 0===e&&(A.progressMsg="Preparing Files Copy",delete A.loadingMsg,a()),U[e]===void 0?(delete A.progressMsg,h(0),void 0):(n=100/U.length*e,t("#single_action_progress").css("width",n+"%"),t("#single_action_progress").find(".inner").html(U[e]),t.ajax({url:E+"copy_files/"+encodeURIComponent(U[e].replace(/\//g,"-"))+"/"+Updater.generateRandomString(),dataType:"json",type:"POST",data:{dir:U[e],action_obj:JSON.stringify(A),server:D},error:function(e){T(e)},success:function(t){return"no"==t.success?(T(t.body),void 0):(m(e+1),void 0)}}),void 0)}function h(e){return q[e]===void 0?(delete A.loadingMsg,b(),void 0):(A.loadingMsg="Updating to: "+q[e].label,a(),t.ajax({url:E+"update_ee/"+q[e].version+"/"+Updater.generateRandomString(),dataType:"json",type:"POST",data:{version:q[e].version,action_obj:JSON.stringify(A),server:D},error:function(e){T(e)},success:function(t){if(null===t)return T("UNKNOWN ERROR"),void 0;if(t.queries)for(var n=0;t.queries.length>n;n++)Updater.queries.push(t.queries[n]+";");return"no"==t.success?(T(t.body),void 0):(h(e+1),void 0)}}),void 0)}function b(){A.loadingMsg="Executing module update routines...",a(),t.ajax({url:E+"update_modules"+"/"+Updater.generateRandomString(),dataType:"json",type:"POST",data:{action_obj:JSON.stringify(A),server:D},error:function(e){T(e)},success:function(e){if("no"==e.success)return T(e.body),void 0;if(e.queries)for(var t=0;e.queries.length>t;t++)Updater.queries.push(e.queries[t]+";");y()}})}function y(){A.loadingMsg="Removing installer files...",a(),M(),t.ajax({url:E+"cleanup"+"/"+Updater.generateRandomString(),dataType:"json",type:"POST",data:{action_obj:JSON.stringify(A),server:D},error:function(e){T(e)},success:function(){A.status="done",delete A.loadingMsg,a()}})}function T(t){t.responseText!==void 0?(A.errorMsg="Unexpected server response, probably a PHP error.",A.errorDetail=e.btoa(t.responseText)):A.errorMsg=t,A.status="error",delete A.loadingMsg,delete A.progressMsg,a()}function k(e){t("#error_log").hide(),t(e.target).closest(".action").removeAttr("status-error").addClass("status-queued"),delete A.errorMsg,delete A.errorDetail,"ee"==A.type?(A.status="processing",a(),_()):(A.status="queued",a(),i())}function M(){Updater.queries.length>0&&j.find("a.queries_exec").show().find(".total").html(Updater.queries.length)}function S(e){e.preventDefault(),t("#queries_executed").slideDown(),t("html, body").stop().animate({scrollTop:t("#queries_executed").offset().top},1e3),t("#queries_executed").find("textarea").html(Updater.queries.join("\n"))}var j,w,A,D,Updater=e.Updater=e.Updater||{},R={},P=(new Date).getTime()/1e3,x=[],X=[],q=[],U=[],E=window.location.protocol+"//"+window.location.host+window.location.pathname+"?/dupdater/";Updater.processInit=function(){document.getElementById("actions_queue")&&(j=Updater.Wrap,w=t("#actions_queue"),j.delegate(".backup_db input, .backup_files input","click",n),n(),j.find(".start_action").click(i),j.delegate(".queries_exec","click",S),j.delegate(".js-retrybtn","click",k))},Updater.addProcessAction=function(e){for(var t,n,a,o=0;e.found.length>o;o++){if(a=[],t=e.found[o],"addon"==t.type||"cp_theme"==t.type||"forum_theme"==t.type)for(var i in t.info)a.push({type:t.type,info:t.info[i]});else a.push({type:t.type,info:t.info});for(var s=0;a.length>s;s++)n={},n.temp_dir=e.temp_dir,n.temp_key=e.temp_key,n.type=a[s].type,n.info=a[s].info,n.updaterAction=a[s].info.updater_action?a[s].info.updater_action:"update",r(n)}}})(window,jQuery),function(e,t){"use strict";function n(e,t){var n={id:t,filename:e.name,filesize:v(e.size,2),status:"queued"};k[t]=n;var r=Updater.Templates.upload_filerow(n);b.find(".js-no_files").hide(),b.append(r)}function r(e,n,r){var a=(n/(r/100)).toFixed(2)+"%";t("#"+e).find(".progress").css("width",a)}function a(){var e=document.createElement("input");e.setAttribute("multiple","multiple"),e.setAttribute("type","file"),e.setAttribute("accept",".zip"),t("#update_upload_placeholder").replaceWith(e),h.find("input").change(o),h.bind("dragover",function(e){e.preventDefault(),e.stopPropagation()}),h.bind("dragleave",function(e){e.preventDefault(),e.stopPropagation()}),h.bind("drop",function(e){e.stopPropagation(),e.preventDefault();for(var t=e.originalEvent.dataTransfer.files,r=0;t.length>r;r++){var a=Math.random().toString(36).substring(2);T[a]=t[r],n(t[r],a)}i()})}function o(e){for(var t=["zip"],r=0;e.target.files.length>r;r++){var a=e.target.files[r].name.toLowerCase().split(".").pop();if(!(0>t.indexOf(a))){var o=Math.random().toString(36).substring(2);T[o]=e.target.files[r],n(e.target.files[r],o)}}i()}function i(){var e=b.find(".file").filter(".status-queued:first"),t=e.attr("id"),n=k[t];if(0===e.length)return delete T[t],!1;n.status="uploading",_(t,n);var a=new XMLHttpRequest;a.upload.onprogress=function(e){r(t,e.loaded,e.total)},a.onload=function(e){s(e,a,t)},a.open("post",y,!0),a.setRequestHeader("Cache-Control","no-cache"),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.setRequestHeader("X-File-Name",n.filename),a.setRequestHeader("X-File-Size",n.fileSize);var o=new FormData;o.append("updater_file",T[t]),a.send(o)}function s(t,n,a){r(a,100,100);var o,s=k[a];if(s.status="error",200==n.status){try{o=JSON.parse(n.responseText)}catch(d){return s.errorMsg="Unexpected server response, probably a PHP error.",s.errorDetail=e.btoa(n.responseText),_(a,s),void 0}if(o.error_msg)return s.errorMsg=o.error_msg,_(a,s),void 0;if("no"==o.success)return s.errorMsg=o.error_msg,_(a,s),void 0;s.status="done",_(a,s),Updater.addProcessAction(o)}else s.errorMsg="Server responded with a "+n.status+" status",s.errorDetail=e.btoa(n.responseText),_(a,s);i()}function d(){var n=120;t("#updater_upload").is(":visible")!==!1&&(n=t("#updater_upload").width()+10),S=new SWFUpload({flash_url:Updater.THEME_URL+"img/swfupload.swf",upload_url:e.location.protocol+y,post_params:{task:"upload_file"},file_post_name:"updater_file",prevent_swf_caching:!0,assume_success_timeout:0,file_size_limit:0,file_types:"*.zip",file_types_description:".zip Files",file_upload_limit:0,file_queue_limit:0,swfupload_preload_handler:function(){},swfupload_load_failed_handler:function(){},file_dialog_start_handler:function(){},file_queued_handler:u,file_queue_error_handler:function(){},file_dialog_complete_handler:c,upload_resize_start_handler:function(){},upload_start_handler:l,upload_progress_handler:p,upload_error_handler:f,upload_success_handler:g,upload_complete_handler:function(){},button_image_url:"",button_placeholder_id:"update_upload_placeholder",button_width:n,button_height:28,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,button_cursor:SWFUpload.CURSOR.HAND,button_action:SWFUpload.BUTTON_ACTION.SELECT_FILES,debug:!0})}function u(e){return n(e,e.id,"")===!1?(this.cancelUpload(e.id,!1),!1):void 0}function c(){this.startUpload()}function l(e){var t=k[e.id];t.status="uploading",_(e.id,t)}function p(e,t,n){r(e.id,t,n)}function f(t,n,r){if("-270"!=n&&"-280"!=n){var a=k[t.id];a.status="error",a.errorMsg="Upload Failed: "+n+" MSG:"+r,a.errorDetail=e.btoa(serverData),_(t.id,a)}}function g(t,n){r(t.id,100,100);var a=k[t.id];a.status="error";try{serverData=JSON.parse(n)}catch(o){return a.errorMsg="Unexpected server response, probably a PHP error.",a.errorDetail=e.btoa(n),_(t.id,a),void 0}return"no"==serverData.success?(a.errorMsg=serverData.error_msg,_(t.id,a),void 0):(a.status="done",_(t.id,a),Updater.addProcessAction(serverData),void 0)}function _(e,n){var r=Updater.Templates.upload_filerow(n);t("#"+e).replaceWith(r)}function v(e,t){var n=["b","KB","MB","GB","TB"];e=Math.max(e,0);var r=Math.floor((e?Math.log(e):0)/Math.log(1024));return r=Math.min(r,n.length-1),e/=Math.pow(1024,r),t="number"==typeof t?t:0,Math.round(e*Math.pow(10,t))/Math.pow(10,t)+" "+n[r]}var Updater=e.Updater=e.Updater||{};e.btoa||(e.btoa=e.base64.encode),e.atob||(e.atob=e.base64.decode);var m,h,b,y,T={},k={},M=document.createElement("input");M.type="file";var S,j="multiple"in M&&e.FormData!==void 0;Updater.uploadInit=function(){document.getElementById("updater_upload")&&(m=Updater.Wrap,h=m.find(".dropregion"),b=t("#upload_queue"),y=Updater.ACT_URL+"&task=upload_file",t(document.body).bind("dragover",function(e){return e.preventDefault(),!1}),t(document.body).bind("drop",function(e){return e.preventDefault(),!1}),j?a():d())}}(window,jQuery),function(e,t){"use strict";function n(){var e=s.find("form").serializeArray(),n=s.find("td.login");n.removeClass("login-failed login-success").addClass("login-testing"),e.push({name:"XID",value:EE.XID}),t.ajax({url:Updater.MCP_AJAX_URL+"&task=test_login",type:"POST",dataType:"json",data:e,success:function(e){"yes"==e.success?n.removeClass("login-testing").addClass("login-success"):n.removeClass("login-testing").addClass("login-failed")}})}function r(){var e=s.find(".js-togglefiletransfer"),t=e.find("input:checked").val(),r=e.closest(".utable");r.find("tbody").hide(),r.find("tbody.js-"+t).show(),("sftp"==t||"ftp"==t)&&n()}function a(e){var n=t("#updater_folder_browse"),r=n.find(".btn-primary"),a=t(e.target).data("map");n.data("mapper",a),d.inputs=s.find("form").serializeArray(),d.loading_elem=n.find(".loading"),d.error_elem=n.find(".error"),d.modal=n,n.modal({backdrop:"static"}),o("chdir",""),r.data("attached")||(r.data("attached",!0),r.click(function(e){e.preventDefault();var t=n.find(".path input").val();s.find(".map-"+n.data("mapper")+" input").attr("value",t),n.modal("hide")}),n.delegate(".cdup","click",function(){o("cdup",n.find(".path input").val())}),n.delegate(".chdir","click",function(e){o("chdir",n.find(".path input").val()+t(e.target).html())}))}function o(e,n){d.error_elem.hide(),d.loading_elem.show(),t.ajax({url:Updater.MCP_AJAX_URL+"&task=browse_server",type:"POST",dataType:"json",data:{settings:d.inputs,path:n,action:e,XID:EE.XID},success:function(e){if(d.loading_elem.hide(),"no"==e.success)return d.error_elem.show(),void 0;e.path&&d.modal.find(".path input").attr("value",e.path);var t=Updater.Templates.browse_server(e.items);d.modal.find(".content").html(t)}})}function i(){t.ajax({url:Updater.ACT_URL+"&task=get_server_info",dataType:"json",type:"POST",data:{XID:EE.XID},error:function(){},success:function(e){Updater.Server=e.server;for(var t in Updater.Server)""===s.find(".map-"+t+" input").val()&&s.find(".map-"+t+" input").attr("value",Updater.Server[t])}})}var Updater=e.Updater=e.Updater||{},s={},d={};Updater.settingsInit=function(){if(document.getElementById("updater-settings")){s=Updater.Wrap,s.delegate(".js-togglefiletransfer","click",r),r(),s.delegate(".pathmap .browse","click",a);var e=0;s.delegate(".js-ftp, .js-sftp","keyup",function(){clearTimeout(e),e=setTimeout(function(){n()},500)}),s.delegate(".retest","click",n),i()}}}(window,jQuery),function(e,t){"use strict";function n(){t.ajax({url:Updater.MCP_AJAX_URL+"&task=clean_temp_dirs",type:"POST",data:{XID:EE.XID}})}function r(e){e.preventDefault();var n=t("#test_transfer_method");n.css({width:"800px","margin-left":function(){return-(t(this).width()/2)}}).modal().find(".loading").show(),n.find(".wrapper").empty(),t.post(Updater.MCP_AJAX_URL+"&task=test_transfer_method",{},function(e){n.find(".loading").hide(),n.find(".wrapper").html(e)})}function a(n){n.preventDefault();var r=t("#error_log"),a=e.atob(t(n.target).closest(".error").find("textarea").val());r.slideDown(),r.find("body").empty(),t("html, body").stop().animate({scrollTop:r.offset().top},1e3),t('<iframe id="updater_error_iframe" style="width:100%;height:300px"/>').load(function(){t("#updater_error_iframe").contents().find("body").append(a)}).appendTo(r.find(".body"))}var Updater=e.Updater=e.Updater||{};Updater.queries=[],Updater.init=function(){Updater.Wrap=t("#updater"),Updater.uploadInit(),Updater.processInit(),Updater.settingsInit(),n(),Updater.Wrap.delegate(".js-test_settings","click",r),Updater.Wrap.delegate(".js-show_error","click",a),Updater.TestAJAX(Updater.MCP_AJAX_URL),Updater.TestAJAX(Updater.ACT_URL)},Updater.generateRandomString=function(){return Math.random().toString(36).substring(2)},Updater.TestAJAX=function(n){var r=t("#test_ajax_error");t.ajax({url:n+"&task=test_ajax_call",dataType:"json",type:"POST",error:function(t){r.show(),r.find("a.url").attr("href",n).html(n),r.find(".error textarea").html(e.btoa(t.responseText)),0===t.status?r.find(".error .inner").html("<strong>Response Code:</strong> "+t.status+"&nbsp;&nbsp;&nbsp;<strong>Response Text</strong>: (Probably Cross-Domain AJAX Error)"):t.status>=200&&r.find(".error .inner").html("<strong>Response Code:</strong> "+t.status+"&nbsp;&nbsp;&nbsp;<strong>Response Text</strong>: "+t.statusText)},success:function(e){e||r.show()}})}}(window,jQuery),$(document).ready(function(){Updater.init()});
//@ sourceMappingURL=/themes/third_party/updater/js/source-map.js